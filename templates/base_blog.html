{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Django Blog | {% block PAGE_TITLE %}{% endblock PAGE_TITLE %}</title>
    <link rel="shortcut icon" href="{% static 'blogger.png' %}">
    <script src="https://kit.fontawesome.com/8b42d3490b.js" crossorigin="anonymous"></script>
    {% load bootstrap5 %}
    {% bootstrap_css %}
    {% bootstrap_javascript %}
</head>
<body style="background-color: #000">
    <nav class="navbar fixed-top navbar-expand-lg navbar-dark border border-secondary border-start-0 border-top-0 border-end-0" style="background-color: #1A1A1B">
        <div class="container-fluid">
          <a class="navbar-brand" href="/">
            <img src="{% static 'blogger.png' %}" width="50">
          </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <form class="d-flex m-auto w-50">
              <input class="form-control me-2 bg-dark text-white w-100" type="search" placeholder="Buscar en blog" aria-label="Search">
            </form>
            <div>
                <button type="button" class="btn btn-outline-warning" data-bs-toggle="modal" data-bs-target="#exampleModal">
                  <span class="fa-solid fa-right-to-bracket me-2"></span>
                  Iniciar sesi贸n
                </button>
            </div>
          </div>
        </div>
    </nav>
    <div class="row w-100">
        <div class="col-md-2 text-white p-3 vh-100 position-fixed" style="background-color: #1A1A1B">
        </div>
        {% block PAGE_CONTENT %}
        {% endblock PAGE_CONTENT %}
    </div>
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="exampleModalLabel">Inicio de sesi贸n</h1>
          </div>
          <div class="modal-body px-5">
            <form class="d-flex flex-column justify-content-center" method="POST" id="login-form">
              {% csrf_token %}
              <div class="mb-3 w-75 mx-auto form-floating">
                <input type="email" class="form-control" id="inputEmailLogin" aria-describedby="emailHelp" placeholder="Correo electr贸nico">
                <label for="inputEmailLogin">Correo electr贸nico</label>
              </div>
              <div class="mb-3 w-75 mx-auto form-floating">
                <input type="password" class="form-control" id="inputPasswordLogin" placeholder="Contrase帽a">
                <label for="inputPasswordLogin">Contrase帽a</label>
              </div>
              <button type="submit" class="btn btn-warning rounded-pill w-50 mx-auto">Iniciar sesi贸n</button>
            </form>
            <div class="mt-4 pt-2 d-flex border border-end-0 border-start-0 border-bottom-0">
              <span class="mx-auto">驴A煤n no tienes cuenta? <a href="/register">Registrate aqu铆</a></span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="{% static 'js/jquery-3.7.0.min.js' %}"></script>
    <script>
      $('#login-form').on('submit', function (event){
        event.preventDefault();
        let form = event.target;
        let formData = new FormData(form);
        fetch("{% url 'blog:login' %}", {
          method: "POST",
          body: formData,
        })
        .then(function(response) {
          console.log(response)
            if( response.ok ) return response.json();
            throw new Error(response.statusText);
        })
        .then(function(data) {
            if( data.error ) {
                Swal.fire('隆Problemas al iniciar sesi贸n !', data.error, 'error')
            } else {
                Swal.fire('隆Inicio de sesi贸n exitoso!', data.message, 'success')
            }
        })
        .catch(function(error) {
            Swal.fire('Error en el inicio', error?.message, 'error')
        });
      })
    </script>
    {% block PAGE_SCRIPT %}
    {% endblock PAGE_SCRIPT %}
</body>
</html>